---
title: "Project 2C: Presentation"
author: "Paul Motten"
date: '`r format(Sys.time(), "%A, %B %d, %Y @ %I:%M %p")`'
output: 
  html_document: 
    theme: cosmo
    highlight: textmate
    code_folding: hide
---

## Setup

### Packages Used

```{r loadpackages, collapse = TRUE}
library(tidyverse)
library(maps)
library(knitr)
if (!require("gganimate")) install.packages("gganimate")
library(gganimate)
if (!require("transformr")) install.packages("transformr")
library(transformr)
if (!require("plotly")) install.packages("plotly")
library(plotly)
if (!require("kableExtra")) install.packages("kableExtra")
library(kableExtra)
```


### Datasets Used

```{r loaddata, collapse = TRUE}
bills <- read_csv("../dataraw/billionaires_2021_10_31.csv")

glimpse(bills)
is_tibble(bills)

ipeds <- read_csv("https://assets.datacamp.com/production/repositories/1942/datasets/18a000cf70d2fe999c6a6f2b28a7dc9813730e74/ipeds.csv")
glimpse(ipeds)

teenNC <- readRDS("../dataprocessed/CDCteenbirthrateNC.rds") %>% 
  mutate(subregion = tolower(county), # to match county map data
         year = as.integer(year)) # to make the animation labels whole numbers
str(teenNC)

### County Data from Maps Package
countymapNC <- map_data("county") %>% 
  filter(region == "north carolina") %>% 
  select(-region) # not needed since it will be all NC data now
str(countymapNC)

```

```{r exploration, collapse = TRUE}

# bills[bills == "$121B"] <- NA  # Check that is.na check is checking correctly.  
#   ###
#   ###  Re-run read_cvs to refresh dataframe after testing
#   ###
#
# for (i in 1:ncol(bills)) {
#   print(which(is.na(bills[ ,i])))
# }


# ggplot(bills, aes(LastChange_Bil, Total_Net_Worth_Bil, color = Industry)) +
#     geom_point() +
#     scale_x_continuous(trans = "log2") +
#     scale_y_continuous(trans = "log2") 

bills_ex <- bills %>%
  group_by(Industry) %>%
  summarise(Sum = sum(Total_Net_Worth_Bil))

bills_red <- bills %>%
  mutate(
    Industry = ifelse(
        bills$Industry == "Technology" |
        bills$Industry == "Industrial" |
        bills$Industry == "Finance" |
        bills$Industry == "Diversified"|
        bills$Industry == "Consumer",
      Industry,
      "Other"),
    LastChange_Prop = (LastChange_Bil + Total_Net_Worth_Bil) / Total_Net_Worth_Bil,
    LastChange_Coef = (LastChange_Bil + mean(Total_Net_Worth_Bil)) / mean(Total_Net_Worth_Bil)
  ) %>%
  rename(`Net Worth (Billions)` = Total_Net_Worth_Bil,
         `Change YTD` =  YTDChange_Bil)

bills_rex <- bills_red %>%
  group_by(Industry) %>%
  summarise(Sum = sum(`Net Worth (Billions)`))


```


```{r billionaires_infographic}

jitter <- position_jitter(width = 0.2, height = 0, seed = 5)

p <- ggplot(bills_red,
       aes(
         x = 1,
         y = `Change YTD`,
         color = Industry,
         size = `Net Worth (Billions)`,
         text = Name
       )) +
  geom_point(position = jitter) +
  geom_point(shape = 1, colour = "gray50", alpha = .2, position = jitter)+ 
  geom_hline(yintercept=0) +
  scale_color_manual(
      breaks = c("Technology", "Industrial", "Finance", "Diversified", "Consumer", "Other"),
      values = c("#AA4499", "#882255", "#117733", "#DDCC77", "#CC6677", "#88CCEE")) +
  scale_y_continuous(n.breaks = 18, minor_breaks = seq(-20, 20, 2)) +
  scale_size(range = c(0, 20)) +
  labs(
      title = "Year-to-Date Change in Net Worth of 500 Wealthiest Individuals",
      subtitle = "as of October 31st, 2021",
      x = NULL,
      y = "Number of Families With x Many Children"
   ) + 
  theme(axis.ticks.x = element_blank(),
        axis.text.x = element_blank())

 ggplotly(p, tooltip = c("text", "size", "y", "color"))

```


 * In a few sentences, explain something about what your plot shows.


```{r mapjoin} 
mapdata <- countymapNC %>% 
  full_join(teenNC, by = "subregion")
```


```{r noaxes, echo = FALSE}
no_axes_theme <- theme(
  axis.text = element_blank(),
  axis.line = element_blank(),
  axis.ticks = element_blank(),
  panel.border = element_blank(),
  panel.grid = element_blank(),
  axis.title = element_blank())
```

```{r process_schools}

schoolsNC <- c(
  "Appalachian State University",
  "East Carolina University",
  "Elizabeth City State University",
  "Fayetteville State University",
  "North Carolina A & T State University",
  "North Carolina Central University",
  "North Carolina State University at Raleigh",
  "University of North Carolina at Asheville",
  "University of North Carolina at Chapel Hill",
  "University of North Carolina at Charlotte",
  "University of North Carolina at Greensboro",
  "University of North Carolina at Pembroke",
  "University of North Carolina Wilmington",
  "University of North Carolina School of the Arts",
  "Western Carolina University",
  "Winston-Salem State University"
)

schoolsNC <- c("Appalachian State University",
"East Carolina University",
"Elizabeth City State University",
"Fayetteville State University",
"North Carolina A & T State University",
"North Carolina Central University",
"North Carolina State University at Raleigh",
"University of North Carolina at Asheville",
"University of North Carolina at Chapel Hill",
"University of North Carolina at Charlotte",
"University of North Carolina at Greensboro",
"University of North Carolina at Pembroke",
"University of North Carolina Wilmington",
"University of North Carolina School of the Arts",
"Western Carolina University",
"Winston-Salem State University")

ipedsNC <- ipeds %>%
  filter (
    # lat < 36.5,
    # lng < -75.554359,
    # lat > 33.888967,
    # lng > -84.321449,
    # sector_label == "Public",
    name %in% schoolsNC
  )

print(ipedsNC)

```



```{r}

teen_anim <- mapdata %>%
   ggplot() +
   geom_polygon(aes(x = long, 
                    y = lat, 
                    group = group, 
                    fill = birth_rate),
                color = "black") +
  coord_map() +
  scale_fill_gradient2(low = "white", mid = "lavender", high = "red", midpoint = 30) +

  transition_states(year, transition_length = 0, state_length = 2, wrap = TRUE) +           #
  geom_point(data = ipedsNC, 
             aes(lng, lat, color = "Location of UNC Campuses"),
             size = 1.5) +
    theme(plot.title = element_text(hjust = 0.5),
          plot.subtitle = element_text(hjust = 0.5)) +
    scale_colour_manual(values = "black", na.value = "black") +
    labs(title = "Change in Teen Birth Rates in North Carolina",
         subtitle = "Year: {closest_state} , per 1,000 females in age group 15â€“19 years",     #
         fill = "Teen Birth Rate",
         color = NULL,
         caption = "Data Source: Centers for Disease Control and Prevention") +
  no_axes_theme

animate(teen_anim, duration = 60, end_pause = 20, start_pause = 8)

```


   * Explain why you chose the dataset you did---what interested you?
   * In a few sentences, explain something about what your plot shows.


```{r}
sessionInfo()
```